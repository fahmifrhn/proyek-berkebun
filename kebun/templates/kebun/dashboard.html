{% extends 'kebun/base.html' %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2">ðŸ“Š Dashboard Kebun</h1>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="row">
                <div class="col-12 mb-4">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">Total Panen per Bulan (gram)</h5>
                            <canvas id="panenChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-12 mb-4">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h5 class="card-title">Distribusi Status Tanaman</h5>
                            <canvas id="statusChart" style="max-height: 250px;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    Statistik Cepat
                </div>
                <div class="card-body">
                    <p class="card-text"><strong>Jumlah Tanaman Aktif:</strong> <span class="badge bg-primary fs-6">{{ jumlah_tanaman }}</span></p>
                </div>
            </div>

            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    Jadwal Mendatang
                </div>
                <ul class="list-group list-group-flush">
                    {% for jadwal in jadwal_mendatang %}
                        <li class="list-group-item">{{ jadwal.tanggal_jadwal }}: {{ jadwal.jenis_kegiatan }} - {{ jadwal.tanaman.nama }}</li>
                    {% empty %}
                        <li class="list-group-item text-muted">Tidak ada jadwal mendatang.</li>
                    {% endfor %}
                </ul>
            </div>

            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    5 Panen Terbaru
                </div>
                <ul class="list-group list-group-flush">
                    {% for panen in panen_terbaru %}
                        <li class="list-group-item">{{ panen.tanggal_panen }}: {{ panen.tanaman.nama }} - {{ panen.jumlah }} {{ panen.satuan }}</li>
                    {% empty %}
                        <li class="list-group-item text-muted">Belum ada data panen.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    {{ labels_panen|json_script:"labels-panen" }}
    {{ data_panen|json_script:"data-panen" }}
    {{ labels_status|json_script:"labels-status" }}
    {{ data_status|json_script:"data-status" }}

{% endblock %}

{% block extra_scripts %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      const labelsPanen = JSON.parse(document.getElementById('labels-panen').textContent);
      const dataPanen = JSON.parse(document.getElementById('data-panen').textContent);
      
      const labelsStatus = JSON.parse(document.getElementById('labels-status').textContent);
      const dataStatus = JSON.parse(document.getElementById('data-status').textContent);
  
      const ctxPanen = document.getElementById('panenChart');
      new Chart(ctxPanen, {
          type: 'bar',
          data: {
              labels: labelsPanen,
              datasets: [{
                  label: 'Total Panen (gram)',
                  data: dataPanen,
                  backgroundColor: 'rgba(75, 192, 192, 0.6)',
                  borderColor: 'rgba(75, 192, 192, 1)',
                  borderWidth: 1
              }]
          },
          options: { scales: { y: { beginAtZero: true } } }
      });
  
      const ctxStatus = document.getElementById('statusChart');
      new Chart(ctxStatus, {
          type: 'doughnut',
          data: {
              labels: labelsStatus,
              datasets: [{
                  label: 'Jumlah Tanaman',
                  data: dataStatus,
                  backgroundColor: [
                      'rgba(255, 99, 132, 0.6)', 'rgba(54, 162, 235, 0.6)',
                      'rgba(255, 206, 86, 0.6)', 'rgba(75, 192, 192, 0.6)',
                      'rgba(153, 102, 255, 0.6)', 'rgba(255, 159, 64, 0.6)'
                  ],
                  hoverOffset: 4
              }]
          }
      });
    </script>
{% endblock %}